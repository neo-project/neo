<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="CleanPluginFiles" AfterTargets="AfterClean">
    <ItemGroup>
      <PluginOutputFiles Include="$(PluginOutDir)/**/*.*" />
    </ItemGroup>
    
    <!-- Delete the plugin directory-->
    <Delete
      Files="%(PluginOutputFiles.Identity)"
      ContinueOnError="true" />

    <!-- Print Message To Output Window -->
    <Message
      Condition=" '@(PluginOutputFiles)' != '' "
      Text="$(MSBuildProjectName) -> Deleted %(PluginOutputFiles.Identity)"
      Importance="high" />
  </Target>

  <Target Name="CopyPluginOutDirFiles" AfterTargets="AfterBuild;AfterRebuild">
    <PropertyGroup>
      <PluginRuntimeId Condition=" '$(PluginRuntimeId)' == '' ">win-x64</PluginRuntimeId>
    </PropertyGroup>
    
    <ItemGroup>
      <PluginOutputFiles Include="$(OutDir)/*.*" />
      <PluginRuntimeFiles Include="$(OutDir)/runtimes/$(PluginRuntimeId)/native/*.*" />
    </ItemGroup>

    <!-- Copy OutDir Contents -->
    <Copy
      SourceFiles="%(PluginOutputFiles.Identity)"
      DestinationFolder="$(PluginOutDir)"
      OverwriteReadOnlyFiles="false"
      ContinueOnError="true"
      SkipUnchangedFiles="true" />
    <Message
      Condition=" '%(PluginOutputFiles.Identity)' != '' "
      Text="$(MSBuildProjectName) -> '%(PluginOutputFiles.Identity)'"
      Importance="high" />

    <!-- Copy Runtime Dlls-->
    <Copy
      SourceFiles="%(PluginRuntimeFiles.Identity)"
      DestinationFolder="$(PluginOutDir)"
      OverwriteReadOnlyFiles="false"
      ContinueOnError="true"
      SkipUnchangedFiles="true" />
    <Message
      Condition=" '%(PluginRuntimeFiles.Identity)' != '' "
      Text="$(MSBuildProjectName) -> '%(PluginRuntimeFiles.Identity)' to '$(PluginOutDir)'"
      Importance="high" />
  </Target>

</Project>
