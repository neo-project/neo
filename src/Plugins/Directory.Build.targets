<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="CleanPluginFiles" AfterTargets="AfterClean">
    <ItemGroup>
      <PluginOutputFiles Include="$(PluginOutDir)/**/*.*" />
    </ItemGroup>
    
    <!-- Delete the plugin directory-->
    <Delete
      Files="%(PluginOutputFiles.Identity)"
      ContinueOnError="true" />

    <!-- Print Message To Output Window -->
    <Message
      Condition=" '@(PluginOutputFiles)' != '' "
      Text="$(MSBuildProjectName) -> Deleted %(PluginOutputFiles.Identity)"
      Importance="high" />
  </Target>

  <Target Name="CopyPluginOutDirFiles" AfterTargets="AfterBuild;AfterRebuild">
    <ItemGroup>
      <PluginBinFiles Include="$(OutDir)/**/*.*" />
      <PluginContentFiles Include="@(Content)" />
      <PluginOutputPath Include="$(PluginOutDir)" />
    </ItemGroup>

    <!-- Copy Plugin Binary-->
    <Copy
      SourceFiles="$(TargetPath)"
      DestinationFolder="@(PluginOutputPath)"
      OverwriteReadOnlyFiles="false"
      ContinueOnError="true"
      SkipUnchangedFiles="true" />
    <Message
      Condition=" '$(TargetPath)' != '' "
      Text="$(MSBuildProjectName) -> '$(TargetPath)'"
      Importance="high" />

    <!-- Copy Content Files -->
    <Copy
      SourceFiles="%(PluginContentFiles.Identity)"
      DestinationFolder="@(PluginOutputPath)"
      OverwriteReadOnlyFiles="false"
      ContinueOnError="true"
      SkipUnchangedFiles="true" />
    <Message
      Condition=" '%(PluginContentFiles.Identity)' != '' "
      Text="$(MSBuildProjectName) -> '%(PluginContentFiles.Identity)'"
      Importance="high" />

    <!-- Copy Dependencies -->
    <Copy
      SourceFiles="%(PluginBinFiles.Identity)"
      DestinationFolder="@(PluginOutputPath)"
      OverwriteReadOnlyFiles="false"
      ContinueOnError="true"
      SkipUnchangedFiles="true" />
    <Message
      Condition=" '%(PluginBinFiles.Identity)' != '' "
      Text="$(MSBuildProjectName) -> '%(PluginBinFiles.Identity)'"
      Importance="high" />
  </Target>

</Project>
