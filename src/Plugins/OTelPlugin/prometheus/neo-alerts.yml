groups:
  - name: neo_node_alerts
    interval: 30s
    rules:
      # Critical Alerts
      - alert: NeoNodeNotSyncing
        expr: rate(neo_blockchain_height[5m]) == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Neo node is not syncing (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} has not processed any blocks in the last 5 minutes. Current height: {{ $value }}"

      - alert: NeoNodeLowPeerCount
        expr: neo_p2p_connected_peers < 3
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Neo node has low peer count (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} has only {{ $value }} connected peers, which risks network isolation"

      - alert: NeoMemPoolNearCapacity
        expr: neo_mempool_capacity_ratio > 0.9
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Neo mempool near capacity (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} mempool is at {{ $value | humanizePercentage }} capacity"

      - alert: NeoHighBlockProcessingTime
        expr: histogram_quantile(0.95, rate(neo_block_processing_time_bucket[5m])) > 2000
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Neo block processing time is high (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} p95 block processing time is {{ $value }}ms"

      # Warning Alerts
      - alert: NeoHighPeerChurn
        expr: rate(neo_p2p_peer_disconnected_total[5m]) > rate(neo_p2p_peer_connected_total[5m])
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Neo node experiencing high peer churn (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} is disconnecting peers faster than connecting"

      - alert: NeoMemPoolCongestion
        expr: neo_mempool_unverified_count / neo_mempool_verified_count > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Neo mempool congestion detected (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} has high unverified to verified transaction ratio: {{ $value }}"

      - alert: NeoSlowBlockProcessing
        expr: histogram_quantile(0.95, rate(neo_block_processing_time_bucket[5m])) > 1000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Neo block processing is slow (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} p95 block processing time is {{ $value }}ms"

      - alert: NeoHighTransactionFailureRate
        expr: rate(neo_transaction_verification_failures_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Neo high transaction failure rate (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} is experiencing {{ $value }} transaction failures per second"

      - alert: NeoMemPoolMemoryHigh
        expr: neo_mempool_memory_bytes > 1073741824  # 1GB
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Neo mempool memory usage high (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} mempool is using {{ $value | humanize1024 }}B of memory"

      - alert: NeoBlockProcessingRateLow
        expr: neo_block_processing_rate < 0.1 and neo_block_processing_rate > 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Neo block processing rate is low (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} is processing only {{ $value }} blocks per second"

      # Info Alerts
      - alert: NeoNodeRestarted
        expr: increase(neo_blocks_processed_total[5m]) == 0 and neo_blockchain_height > 0
        for: 1m
        labels:
          severity: info
        annotations:
          summary: "Neo node may have restarted (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} shows no block processing activity"

      - alert: NeoHighNetworkTraffic
        expr: rate(neo_p2p_bytes_received_total[5m]) + rate(neo_p2p_bytes_sent_total[5m]) > 10485760  # 10MB/s
        for: 5m
        labels:
          severity: info
        annotations:
          summary: "Neo node experiencing high network traffic (instance {{ $labels.instance }})"
          description: "Neo node {{ $labels.instance }} network traffic is {{ $value | humanize1024 }}B/s"